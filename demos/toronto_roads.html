<head>     
  <meta charset="utf-8" />     
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />     
  <title>Toronto roadways</title>     
  <style>     
    html,     
    body {     
        background-color: var(--calcite-ui-foreground-2);     
        padding: 0;     
        margin: 0;     
        width: 100vw;     
        height: 100vh;     
    }  
  </style>     
    <link rel="stylesheet" href="https://js.arcgis.com/4.32/esri/themes/light/main.css" />   
    <script src="https://js.arcgis.com/4.32/"></script> 
    <script   
    type="module"   
    src="https://js.arcgis.com/map-components/4.32/arcgis-map-components.esm.js"   
   ></script> 
</head>     
<body>  
  <arcgis-map basemap="gray-3d" zoom="10" center="-79.379966, 43.740473"></arcgis-map>

  <script>
    // Dynamically determine the base URL for config.js
    const baseUrl = window.location.hostname === 'kdmonroe.github.io' 
      ? '/arcgis-js-maps/shared/config.js' 
      : '../shared/config.js';
    
    // Create and load the script element dynamically
    const configScript = document.createElement('script');
    configScript.src = baseUrl;
    configScript.onload = function() {
      // Initialize ArcGIS only after config is loaded
      require(["esri/config", "esri/layers/FeatureLayer"], function(esriConfig, FeatureLayer) {
        esriConfig.apiKey = window.arcgisConfig.apiKey;
        const arcgisMap = document.querySelector("arcgis-map");
        arcgisMap.addEventListener("arcgisViewReadyChange", () => {
          try {
            // Add city boundary first
            const torontoBoundary = new FeatureLayer({   
              url: "https://services.arcgis.com/ue9rwulIoeLEI9bj/arcgis/rest/services/Toronto_City_Boundary/FeatureServer",
              outFields: ["*"],
              title: "Toronto Boundary"
            }); 
            arcgisMap.addLayer(torontoBoundary);
            
            // Add roads second
            const torontoRoads = new FeatureLayer({   
              url: "https://services.arcgis.com/ue9rwulIoeLEI9bj/arcgis/rest/services/Toronto_Roads/FeatureServer",
              outFields: ["*"],
              title: "Toronto Roads"
            }); 
            arcgisMap.addLayer(torontoRoads);
            
            // Add parking permits last
            const torontoPermits = new FeatureLayer({   
              url: "https://services.arcgis.com/ue9rwulIoeLEI9bj/arcgis/rest/services/Parking_Permit_Areas/FeatureServer",
              outFields: ["*"],
              title: "Parking Permit Areas"
            }); 
            arcgisMap.addLayer(torontoPermits);
            
            console.log("All layers added successfully");
          } catch (error) {
            console.error("Error loading feature layers:", error);
          }
        });
      });
    };
    document.head.appendChild(configScript);
  </script>
</body>
</html>