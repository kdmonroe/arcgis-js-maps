<head>     
  <meta charset="utf-8" />     
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />     
  <title>Toronto roadways</title>     
  <style>     
    html,     
    body {     
        background-color: var(--calcite-ui-foreground-2);     
        padding: 0;     
        margin: 0;     
        width: 100vw;     
        height: 100vh;     
    }  
  </style>     
    <link rel="stylesheet" href="https://js.arcgis.com/4.32/esri/themes/light/main.css" />   
    <script src="https://js.arcgis.com/4.32/"></script> 
    <script   
    type="module"   
    src="https://js.arcgis.com/map-components/4.32/arcgis-map-components.esm.js"   
   ></script> 
</head>     
<body>  
  <arcgis-map basemap="gray-vector" zoom="10" center="-79.379966, 43.740473"></arcgis-map>

  <script>
    // Dynamically determine the base URL for config.js
    const baseUrl = window.location.hostname === 'kdmonroe.github.io' 
      ? '/arcgis-js-maps/shared/config.js' 
      : '../shared/config.js';
    
    // Create and load the script element dynamically
    const configScript = document.createElement('script');
    configScript.src = baseUrl;
    configScript.onload = function() {
      // Initialize ArcGIS only after config is loaded
      require([
        "esri/config", 
        "esri/layers/FeatureLayer"
      ], function(esriConfig, FeatureLayer) {
        // Set API key
        esriConfig.apiKey = window.arcgisConfig.apiKey;
        
        // Get map component
        const arcgisMap = document.querySelector("arcgis-map");
        
        // Wait for map to be fully loaded
        arcgisMap.when = function() {
          return new Promise((resolve) => {
            if (arcgisMap.view) {
              resolve(arcgisMap.view);
            } else {
              arcgisMap.addEventListener("arcgisViewReady", () => {
                console.log("Map view is ready");
                resolve(arcgisMap.view);
              });
            }
          });
        };
        
        arcgisMap.when().then(() => {
          console.log("Adding layers to map");
          
          // Create feature layers
          const torontoPermits = new FeatureLayer({
            url: "https://services.arcgis.com/ue9rwulIoeLEI9bj/arcgis/rest/services/Parking_Permit_Areas/FeatureServer",
            title: "Parking Permit Areas"
          });
          
          const torontoRoads = new FeatureLayer({
            url: "https://services.arcgis.com/ue9rwulIoeLEI9bj/arcgis/rest/services/Toronto_Roads/FeatureServer",
            title: "Toronto Roads"
          });
          
          const torontoBoundary = new FeatureLayer({
            url: "https://services.arcgis.com/ue9rwulIoeLEI9bj/arcgis/rest/services/Toronto_City_Boundary/FeatureServer",
            title: "Toronto Boundary"
          });
          
          // Add layers individually
          arcgisMap.addLayer(torontoPermits);
          arcgisMap.addLayer(torontoRoads);
          arcgisMap.addLayer(torontoBoundary);
          
          console.log("All layers added");
        }).catch(error => {
          console.error("Error loading map:", error);
        });
      });
    };
    document.head.appendChild(configScript);
  </script>
</body>
</html>